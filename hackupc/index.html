<html>
	<head>
	    <meta name="viewport" content="width=400">
	   
		<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
		<script src="./jquery.signaturepad.min.js"></script> 
		<script src="https://github.com/niklasvh/html2canvas/releases/download/0.4.1/html2canvas.js"></script>
		
		<script src='utils.js'></script>
		
		<style>
			input[type='text'] {
				height: 30px;
			}

			canvas {
				outline-style: solid;
				outline-color: black;
				outline-width: 1px;
			}
			
			button {
				width: 200px;
				font-size: 12px;
			}

			#btnSaveSign {
				height: 100px;
				font-size: 24px;
			}
			
			div#signArea {
				width: 200px;
				margin: 100px auto;
			}
		</style>
	</head>
	<body>
		<a href="./predict.php">Go to predict</a>
		<div id="signArea" >
			
			<h3 class="tag-ingo">Please, draw your signature</h3>
			<input type="text" placeholder="Autor de la firma" />
			<br />
			<span id="signs_counter">0</span>/5 signatures done
			<br />
			<br />

			<div class="sig sigWrapper" style="height:auto;">
				<div class="typed"></div>
				<canvas class="sign-pad" id="sign-pad" width="200px" height="125px"></canvas>
			</div>			
			
			<br />
			<button id="btnSaveSign">Guardar signatura</button>
			<button id="clearCanvas">Clear signatura</button>
		</div>
		
		<script>
			$(document).ready(function() {
			    draw_counter = 0;
			    signs_counter = 0;
			    canvas_counter = 0;
			    imgs_data = [];
			    
				var pad = $('#signArea').signaturePad({
					drawOnly:true,
					penWidth : 5,
					lineColour : '#fff',
					penColour : '#ff1a1a',
					onDraw: function () {
					    if (draw_counter++ % 5 == 0) {
					        let img = pad.getSignatureImage();
					        saveCanvas(imgs_data, canvas_counter++, img);
					    }
    				},
    				onDrawEnd: function () {
    				    console.log('Draw ended.');
    				}
				});
				
    			$("#clearCanvas").click(function() {
    			    imgs_data = [];
    			    canvas_counter = 0;
                	pad.clearCanvas();
                });
                
                $("#btnSaveSign").click(function(e){
                	html2canvas([document.getElementById('sign-pad')], {
                		onrendered: function (canvas) {
                			var author = $('input[type="text"]').val();
                			if (author == "") {
                				alert("Posa l'autor, carellot!");
                				return false;
                			}
                			                			
                    		save2Image(imgs_data, author);
                            
                            $('#signs_counter').html(++signs_counter);
                            $("#clearCanvas").click();
                            
                            if (signs_counter >= 5) {
                                $('#signArea').html(
                                      'Signature successfully added. '
                                    + 'Thank you for your time. '
                                    + 'We definitely won\'t use this for forgery, maybe.'
                                );
                            }
                		}
                	});
                });
			});
		</script>
	</body>
</html>
